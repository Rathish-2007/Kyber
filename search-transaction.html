<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transaction Search</title>
    <link rel="stylesheet" href="search-transaction.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Transaction Search</h1>
            <p>Search and view detailed information about transactions</p>
        </header>
        
        <div class="search-container">
            <div class="search-box">
                <input type="text" class="search-input" placeholder="Enter transaction hash, address, or block number">
                <button class="search-btn">Search</button>
            </div>
            
            <div class="filters">
                <div class="filter-group">
                    <label for="type-filter">Transaction Type</label>
                    <select id="type-filter" class="filter-select">
                        <option value="all">All Types</option>
                        <option value="incoming">Incoming</option>
                        <option value="outgoing">Outgoing</option>
                        <option value="contract">Contract</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="status-filter">Status</label>
                    <select id="status-filter" class="filter-select">
                        <option value="all">All Statuses</option>
                        <option value="completed">Completed</option>
                        <option value="pending">Pending</option>
                        <option value="failed">Failed</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="date-filter">Date Range</label>
                    <select id="date-filter" class="filter-select">
                        <option value="all">All Time</option>
                        <option value="today">Today</option>
                        <option value="week">Past Week</option>
                        <option value="month">Past Month</option>
                    </select>
                </div>
            </div>
        </div>
        
        <div class="results-container">
            <div class="results-header">
                <h2 class="results-title">Transaction History</h2>
            </div>
            
            <div class="transaction-list">
                <!-- Transaction 1 -->
                <!-- Transactions will be rendered here dynamically -->
            </div>
            
        </div>
    </div>

    <script>
        // Fetch available types and statuses from backend
        async function fetchDropdownOptions() {
            // You need to implement /api/transaction-options in your backend for this to work
            try {
                const res = await fetch('/api/transaction-options');
                const data = await res.json();
                // Populate type dropdown
                const typeSelect = document.getElementById('type-filter');
                typeSelect.innerHTML = '<option value="all">All Types</option>';
                data.types.forEach(type => {
                    typeSelect.innerHTML += `<option value="${type}">${type.charAt(0).toUpperCase() + type.slice(1)}</option>`;
                });
                // Populate status dropdown
                const statusSelect = document.getElementById('status-filter');
                statusSelect.innerHTML = '<option value="all">All Statuses</option>';
                data.statuses.forEach(status => {
                    statusSelect.innerHTML += `<option value="${status}">${status.charAt(0).toUpperCase() + status.slice(1)}</option>`;
                });
            } catch (err) {
                console.error('Failed to fetch dropdown options:', err);
            }
        }
        // Dynamic transaction rendering
        async function fetchTransactions(params = {}) {
            const query = new URLSearchParams(params).toString();
            const res = await fetch(`/api/transactions?${query}`);
            const data = await res.json();
            return data.transactions || [];
        }

        function renderTransactions(transactions) {
            const list = document.querySelector('.transaction-list');
            list.innerHTML = '';
            transactions.forEach(txn => {
                const item = document.createElement('div');
                item.className = 'transaction-item';
                item.innerHTML = `
                    <div class="txn-hash">${txn.transaction_hash ? txn.transaction_hash.substring(0,10) + '...' : ''}</div>
                    <div class="txn-detail"><span class="txn-label">From</span><span class="txn-value">${txn.from_address || '-'}</span></div>
                    <div class="txn-detail"><span class="txn-label">To</span><span class="txn-value">${txn.to_address || '-'}</span></div>
                    <div class="txn-detail"><span class="txn-label">Amount</span><span class="txn-value">${txn.amount} ETH</span></div>
                    <div class="txn-detail"><span class="txn-label">Date</span><span class="txn-value">${new Date(txn.transaction_date).toLocaleDateString()}</span></div>
                    <div class="txn-detail"><span class="txn-label">Status</span><span class="txn-status status-${txn.status}">${txn.status}</span></div>
                    <button class="view-btn">View Details</button>
                    <div class="transaction-details" style="display:none;">
                        <div class="details-grid">
                            <div class="detail-item"><span class="txn-label">Transaction Hash</span><span class="txn-value">${txn.transaction_hash}</span></div>
                            <div class="detail-item"><span class="txn-label">Block Number</span><span class="txn-value">${txn.block_number || '-'}</span></div>
                            <div class="detail-item"><span class="txn-label">Gas Used</span><span class="txn-value">${txn.gas_used || '-'}</span></div>
                            <div class="detail-item"><span class="txn-label">Transaction Fee</span><span class="txn-value">${txn.transaction_fee || '-'}</span></div>
                            ${txn.error ? `<div class="detail-item"><span class="txn-label">Error</span><span class="txn-value">${txn.error}</span></div>` : ''}
                        </div>
                    </div>
                `;
                // Toggle details
                item.querySelector('.view-btn').addEventListener('click', function() {
                    const details = item.querySelector('.transaction-details');
                    const isVisible = details.style.display === 'block';
                    document.querySelectorAll('.transaction-details').forEach(d => d.style.display = 'none');
                    document.querySelectorAll('.view-btn').forEach(btn => btn.textContent = 'View Details');
                    if (!isVisible) {
                        details.style.display = 'block';
                        this.textContent = 'Hide Details';
                    }
                });
                list.appendChild(item);
            });
        }

        async function updateTransactions() {
            const search = document.querySelector('.search-input').value;
            const type = document.getElementById('type-filter').value;
            const status = document.getElementById('status-filter').value;
            const date = document.getElementById('date-filter').value;
            // For demo, page=1, pageSize=10
            const transactions = await fetchTransactions({ search, type, status, date, page: 1, pageSize: 10 });
            renderTransactions(transactions);
        }

        // Event listeners
        document.querySelector('.search-btn').addEventListener('click', updateTransactions);
        document.querySelector('.search-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') updateTransactions();
        });
        document.getElementById('type-filter').addEventListener('change', updateTransactions);
        document.getElementById('status-filter').addEventListener('change', updateTransactions);
        document.getElementById('date-filter').addEventListener('change', updateTransactions);

        // Initial load
    fetchDropdownOptions().then(updateTransactions);
    </script>
</body>
</html>